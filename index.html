<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Flipbook Viewer</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    body{
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, sans-serif;
      background: linear-gradient(135deg,#ff6b6b 0%,#a50034 100%);
      min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;
      color:#111; user-select:none;
    }
    .wrap{width:min(100%, 900px)}

    .upload-zone {
      border: 2px dashed #fff;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      color: #fff;
      background: rgba(255,255,255,0.1);
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-zone:hover {
      background: rgba(255,255,255,0.2);
      border-color: #ffcccc;
    }

    .upload-zone.dragover {
      background: rgba(255,255,255,0.3);
      border-color: #fff;
    }

    #fileInput {
      display: none;
    }

    .flipbook{
      position:relative; width:100%; aspect-ratio: 1.414;
      background:#fff; border-radius:8px; box-shadow:0 20px 40px rgba(0,0,0,.3); overflow:hidden;
      perspective: 1500px; transform-style: preserve-3d; margin:0 auto;
      -webkit-user-select:none; user-select:none; -webkit-touch-callout:none; -webkit-user-drag:none;
      display: none;
    }

    .spread { 
      position:absolute; inset:0; display:flex;
      transform-style: preserve-3d;
    }

    .page-container {
      position: relative;
      width: 50%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .page {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-position: center;
      background-size: contain;
      background-repeat: no-repeat;
      background-color: #fff;
      backface-visibility: hidden;
      transform-style: preserve-3d;
    }

    .page.front {
      z-index: 2;
    }

    .page.back {
      transform: rotateY(180deg);
      z-index: 1;
    }

    .page.blank { 
      background: #fff !important; 
    }

    .page-container.left { 
      transform-origin: right center;
      border-right: 1px solid rgba(0,0,0,.06);
    }

    .page-container.right { 
      transform-origin: left center;
    }

    .page-container.flipping {
      transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 1000;
    }

    .page-container.flip-left {
      transform: rotateY(180deg);
    }

    .page-container.flip-right {
      transform: rotateY(-180deg);
    }

    .page-container.flipping::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, 
        rgba(0,0,0,0.1) 0%, 
        rgba(0,0,0,0.3) 50%, 
        rgba(0,0,0,0.1) 100%
      );
      z-index: 10;
      opacity: 0;
      transition: opacity 0.8s ease;
      pointer-events: none;
    }

    .page-container.flipping.shadow::after {
      opacity: 1;
    }

    .flipbook::before{
      content:''; position:absolute; top:0; bottom:0; left:50%; width:2px; transform:translateX(-1px);
      background: linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,0) 40%, rgba(0,0,0,.12));
      opacity:.25; pointer-events:none; z-index: 500;
    }

    .controls{ display:flex; justify-content:center; align-items:center; gap:12px; margin-top:20px }
    .nav-btn{
      background:#fff; color:#e60012; border:none; padding:12px 20px; border-radius:999px; cursor:pointer;
      font-size:15px; font-weight:700; transition: transform .15s ease, box-shadow .15s ease; box-shadow:0 6px 18px rgba(230,0,18,.35);
      user-select:none; -webkit-user-select:none;
    }
    .nav-btn:hover{ transform: translateY(-1px); box-shadow:0 10px 24px rgba(230,0,18,.45); }
    .nav-btn:disabled{ opacity:.5; cursor:not-allowed; transform:none; box-shadow:none }

    .page-info {
      color: #fff;
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    .loading{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      background: rgba(255,255,255,.95); z-index:2000; gap:10px }
    .spinner{ width:30px; height:30px; border:3px solid #f3f3f3; border-top:3px solid #e60012; border-radius:50%; animation:spin .8s linear infinite }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    .progress-bar {
      width: 200px;
      height: 4px;
      background: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: #e60012;
      width: 0%;
      transition: width 0.3s ease;
    }

    @media (max-width: 768px){ 
      .wrap{width:90vw} 
      .nav-btn{ padding:10px 16px; font-size:14px }
      .upload-zone { padding: 20px; }
    }
    @media (prefers-reduced-motion: reduce){ .page-container{ transition:none !important } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="upload-zone" id="uploadZone">
      <h3>üìÑ Upload PDF File</h3>
      <p>Drag and drop your PDF here, or click to browse</p>
      <p style="font-size: 12px; margin-top: 10px; opacity: 0.8;">Supported: PDF files</p>
      <input type="file" id="fileInput" accept=".pdf" />
    </div>

    <div class="flipbook" id="flipbook" aria-label="Flipbook">
      <div class="loading" id="loading" style="display: none;">
        <div class="spinner"></div>
        <div>Processing PDF...</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="progressText">0%</div>
      </div>
    </div>

    <div class="controls" aria-label="Pagination controls" style="display: none;" id="controls">
      <button class="nav-btn" id="prevBtn">‚Üê Previous</button>
      <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
    </div>

    <div class="page-info" id="pageInfo" style="display: none;"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // Configure PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const CONFIG = {
      animationDuration: 800,
      renderScale: 2 // Higher quality rendering
    };

    let currentSpread = 0, isAnimating = false;
    let pdfPages = []; // Array of rendered page data URLs
    let totalPages = 0;

    const $ = s => document.querySelector(s);
    const flipbook = $('#flipbook');
    const loading = $('#loading');
    const controls = $('#controls');
    const pageInfo = $('#pageInfo');
    const uploadZone = $('#uploadZone');
    const fileInput = $('#fileInput');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const progressFill = $('#progressFill');
    const progressText = $('#progressText');

    // Upload handling
    uploadZone.addEventListener('click', () => fileInput.click());
    uploadZone.addEventListener('dragover', handleDragOver);
    uploadZone.addEventListener('drop', handleDrop);
    uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
    fileInput.addEventListener('change', handleFileSelect);

    // Navigation
    prevBtn.addEventListener('click', previousPage);
    nextBtn.addEventListener('click', nextPage);

    document.addEventListener('keydown', e => {
      if(['ArrowLeft','ArrowUp'].includes(e.key)){ e.preventDefault(); previousPage(); }
      if(['ArrowRight','ArrowDown'].includes(e.key)){ e.preventDefault(); nextPage(); }
    });

    function handleDragOver(e) {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if(files.length > 0 && files[0].type === 'application/pdf') {
        processPDF(files[0]);
      }
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if(file && file.type === 'application/pdf') {
        processPDF(file);
      }
    }

    async function processPDF(file) {
      uploadZone.style.display = 'none';
      flipbook.style.display = 'block';
      loading.style.display = 'flex';
      
      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        totalPages = pdf.numPages;
        
        pdfPages = [];
        
        // Render each page
        for(let pageNum = 1; pageNum <= totalPages; pageNum++) {
          const page = await pdf.getPage(pageNum);
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          
          const viewport = page.getViewport({ scale: CONFIG.renderScale });
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          
          await page.render({
            canvasContext: context,
            viewport: viewport
          }).promise;
          
          pdfPages.push(canvas.toDataURL('image/jpeg', 0.9));
          
          // Update progress
          const progress = (pageNum / totalPages) * 100;
          progressFill.style.width = progress + '%';
          progressText.textContent = Math.round(progress) + '%';
        }
        
        // Initialize flipbook
        createSpread();
        updateSpreadContent();
        
        loading.style.display = 'none';
        controls.style.display = 'flex';
        pageInfo.style.display = 'block';
        updateControls();
        updatePageInfo();
        
      } catch (error) {
        console.error('Error processing PDF:', error);
        loading.innerHTML = '<div style="color:#e74c3c;">Error loading PDF. Please try another file.</div>';
      }
    }

    function createSpread() {
      // Clear any existing content
      flipbook.innerHTML = '';
      
      const spread = document.createElement('div');
      spread.className = 'spread';
      
      const leftContainer = document.createElement('div');
      leftContainer.className = 'page-container left';
      leftContainer.id = 'leftContainer';
      
      const rightContainer = document.createElement('div');
      rightContainer.className = 'page-container right';
      rightContainer.id = 'rightContainer';
      
      spread.appendChild(leftContainer);
      spread.appendChild(rightContainer);
      flipbook.appendChild(spread);
    }

    function updateSpreadContent() {
      const leftContainer = $('#leftContainer');
      const rightContainer = $('#rightContainer');
      
      leftContainer.innerHTML = '';
      rightContainer.innerHTML = '';
      
      const leftPageNum = currentSpread * 2;
      const rightPageNum = currentSpread * 2 + 1;
      
      // LEFT CONTAINER: front=current even page, back=previous even page
      createPagePair(leftContainer, leftPageNum, leftPageNum - 2);
      
      // RIGHT CONTAINER: front=current odd page, back=next even page  
      createPagePair(rightContainer, rightPageNum, rightPageNum + 1);
    }

    function createPagePair(container, frontIndex, backIndex) {
      // Front page
      const front = document.createElement('div');
      front.className = 'page front';
      
      if(frontIndex === 0) {
        front.classList.add('blank'); // First page is blank
      } else if(frontIndex > 0 && frontIndex <= totalPages) {
        front.style.backgroundImage = `url('${pdfPages[frontIndex - 1]}')`;
      } else {
        front.classList.add('blank');
      }
      
      // Back page
      const back = document.createElement('div');
      back.className = 'page back';
      back.style.transform = 'rotateY(180deg)';
      
      if(backIndex === 0) {
        back.classList.add('blank');
      } else if(backIndex > 0 && backIndex <= totalPages) {
        back.style.backgroundImage = `url('${pdfPages[backIndex - 1]}')`;
      } else {
        back.classList.add('blank');
      }
      
      container.appendChild(front);
      container.appendChild(back);
    }

    function nextPage() {
      if(isAnimating) return;
      
      const maxSpreads = Math.ceil((totalPages + 1) / 2); // +1 for blank first page
      if(currentSpread >= maxSpreads - 1) return;
      
      isAnimating = true;
      updateControls();
      
      const rightContainer = $('#rightContainer');
      rightContainer.classList.add('flipping', 'shadow');
      
      requestAnimationFrame(() => {
        rightContainer.classList.add('flip-right');
      });
      
      setTimeout(() => {
        currentSpread++;
        updateSpreadContent();
        resetAnimations();
        isAnimating = false;
        updateControls();
        updatePageInfo();
      }, CONFIG.animationDuration);
    }

    function previousPage() {
      if(isAnimating || currentSpread <= 0) return;
      
      isAnimating = true;
      updateControls();
      
      const leftContainer = $('#leftContainer');
      leftContainer.classList.add('flipping', 'shadow');
      
      requestAnimationFrame(() => {
        leftContainer.classList.add('flip-left');
      });
      
      setTimeout(() => {
        currentSpread--;
        updateSpreadContent();
        resetAnimations();
        isAnimating = false;
        updateControls();
        updatePageInfo();
      }, CONFIG.animationDuration);
    }

    function resetAnimations() {
      const containers = [document.getElementById('leftContainer'), document.getElementById('rightContainer')];
      containers.forEach(container => {
        if(container) {
          container.classList.remove('flipping', 'shadow', 'flip-left', 'flip-right');
        }
      });
    }

    function updateControls(){
      const maxSpreads = Math.ceil((totalPages + 1) / 2);
      prevBtn.disabled = (currentSpread <= 0) || isAnimating;
      nextBtn.disabled = (currentSpread >= maxSpreads - 1) || isAnimating;
    }

    function updatePageInfo() {
      const leftPageNum = currentSpread * 2;
      const rightPageNum = currentSpread * 2 + 1;
      
      let leftDisplay = leftPageNum === 0 ? 'Cover' : leftPageNum > totalPages ? '' : leftPageNum.toString();
      let rightDisplay = rightPageNum > totalPages ? '' : rightPageNum.toString();
      
      if(leftDisplay && rightDisplay) {
        pageInfo.textContent = `Pages ${leftDisplay} - ${rightDisplay} of ${totalPages}`;
      } else if(rightDisplay) {
        pageInfo.textContent = `Page ${rightDisplay} of ${totalPages}`;
      } else if(leftDisplay) {
        pageInfo.textContent = `Page ${leftDisplay} of ${totalPages}`;
      }
    }
  </script>
</body>
</html>
